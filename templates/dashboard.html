{% extends "layout.html" %}

{% block content %}

<!-- ðŸŽ¨ INTERNAL CSS (Self-Contained Styles for Dashboard) -->
<style>
    /* Card Container */
    .dashboard-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.05);
        border: 1px solid #f1f5f9;
        overflow: hidden;
        margin-top: 20px;
    }

    .dashboard-header-text {
        padding: 25px;
        border-bottom: 1px solid #f1f5f9;
        font-weight: 700;
        color: #1e293b;
        font-size: 1.1rem;
        background: white;
    }

    /* List Item Row */
    .list-item {
        padding: 20px 25px;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        align-items: center;
        justify-content: space-between;
        text-decoration: none;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        background: white;
    }

    /* Hover Animation: Slide & Highlight */
    .list-item:hover {
        background-color: #f8fafc;
        transform: translateX(5px);
        border-left: 4px solid #0d9488; /* Teal Accent */
        padding-left: 21px; /* Adjust for border width */
    }

    /* Text Styles */
    .item-title {
        font-weight: 600;
        color: #1e293b;
        font-size: 0.95rem;
        display: block;
        margin-bottom: 4px;
    }

    .item-date {
        font-size: 0.8rem;
        color: #94a3b8;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    /* Status Pills */
    .status-pill {
        padding: 6px 16px;
        border-radius: 50px;
        font-size: 12px;
        font-weight: 600;
        text-transform: capitalize;
        min-width: 90px;
        text-align: center;
        display: inline-block;
    }

    .pill-launch { background: #dcfce7; color: #166534; }  /* Green */
    .pill-delay  { background: #fef3c7; color: #92400e; }  /* Yellow/Orange */
    .pill-cancel { background: #fee2e2; color: #991b1b; }  /* Red */

    /* Circular Score */
    .score-circle {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 14px;
        border: 2px solid; 
    }

    /* Arrow Button */
    .arrow-btn {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background: #ccfbf1; /* Light Teal */
        color: #0f766e;      /* Dark Teal */
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        transition: all 0.2s;
    }

    .list-item:hover .arrow-btn {
        background: #0d9488; /* Dark Teal */
        color: white;
        transform: translateX(3px);
    }
</style>

<!-- HEADER SECTION -->
<div style="margin-bottom: 2rem; margin-top: 1rem;">
    <h2 style="font-weight: 700; color: #0d9488; margin-bottom: 5px;">Dashboard</h2>
    <p style="color: #64748b; font-size: 0.95rem;">Manage your product launch decisions with AI-powered insights</p>
    
    <!-- New Analysis Button -->
    <a href="/analyze" style="
        background-color: #0d9488; 
        color: white; 
        padding: 12px 24px; 
        border-radius: 8px; 
        text-decoration: none; 
        font-weight: 600; 
        display: inline-block; 
        margin-top: 10px;
        box-shadow: 0 4px 6px rgba(13, 148, 136, 0.2);">
        <i class="fas fa-plus" style="margin-right: 8px;"></i> New Product Analysis
    </a>
</div>

<!-- MAIN CARD -->
<div class="dashboard-card">
    
    <!-- Card Header -->
    <div class="dashboard-header-text">
        Previous Decisions
    </div>

    <!-- List Container -->
    <div>
        {% for item in history %}
        <a href="/result/{{ item._id }}" class="list-item">
            
            <!-- Left Side: Product Name & Date -->
            <div style="min-width: 200px;">
                <span class="item-title">{{ item.details.name }}</span>
                <span class="item-date">
                    <i class="far fa-calendar-alt"></i> {{ item.timestamp.strftime('%Y-%m-%d') }}
                </span>
            </div>

            <!-- Right Side: Status, Score, Arrow -->
            <div style="display: flex; align-items: center; gap: 20px;">
                
                <!-- 1. Status Pill -->
                {% if 'LAUNCH' in item.ai_result.decision %}
                    <span class="status-pill pill-launch">Launched</span>
                {% elif 'DELAY' in item.ai_result.decision %}
                    <span class="status-pill pill-delay">Delayed</span>
                {% else %}
                    <span class="status-pill pill-cancel">Cancelled</span>
                {% endif %}

                <!-- 2. Circular Score Indicator -->
                <div class="score-circle" style="
                    {% if 'LAUNCH' in item.ai_result.decision %} border-color: #10b981; color: #10b981;
                    {% elif 'DELAY' in item.ai_result.decision %} border-color: #0d9488; color: #0d9488;
                    {% else %} border-color: #ef4444; color: #ef4444; {% endif %}">
                    {{ item.ai_result.avg | int }}
                </div>

                <!-- 3. Arrow Icon -->
                <div class="arrow-btn">
                    <i class="fas fa-arrow-right"></i>
                </div>

            </div>
        </a>
        {% else %}
        <!-- Empty State -->
        <div style="padding: 50px; text-align: center; color: #94a3b8;">
            <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
            <p>No analysis history found.</p>
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}